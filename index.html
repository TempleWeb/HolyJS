<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HolyC Interpreter</title>
  <script src="holyc-online-highlighter/holyc-online-highlighter.js"></script>
  <script src="holyc-online-interpreter.js"></script>
  <style>
    * {
      text-align: center;
      padding: 0;
      margin: 0;
      font-family: monospace;
    }

    textarea {
      background-color: #55FFFF;
      resize: none;
      text-align: left;
      position: relative;
      color: transparent;
      caret-color: black;
      font-size: large;
      white-space: break-spaces;
      outline: 5px solid #0000AA;
      border: 0px;
    }

    #hl {
      overflow: hidden;
      pointer-events: none;
      font-size: large;
      position: absolute;
      top: 76px;
      left: 25vw;
      -webkit-overflow-scrolling: touch;
      text-align: left;
    }

    span {
      white-space: pre-wrap;
      word-break: break-word;
      overflow-wrap: break-word;
      -ms-word-break: break-word;
      word-break: break-word;
      -ms-hyphens: auto;
      -moz-hyphens: auto;
      -webkit-hyphens: auto;
      hyphens: auto;
      overflow-wrap: break-word;
    }

    textarea,
    #hl {
      width: 50vw;
      height: 40vh;
      text-align: left;
    }

    @media only screen and (max-width: 400px) {
      #hl {
        top: 120px;
      }
    }

    textarea::-moz-selection {
      /* Code for Firefox */
      background: white;
    }

    textarea::selection {
      background: white;
    }
  </style>
</head>

<body>
  <noscript>
    <p><b>WARNING: JavaScript is Disabled!</b></p>
    <p>
      HOLYC Interpreter requires JavaScript. Please enable JavaScript for the
      interpreter to work.
    </p>
  </noscript>

  <main>
    <br>
    <b>
      <a href="http://leozamboni.github.io/compilers/holyc/2022/03/01/holyc-interpreter.html">"HolyC Interpreter"</a>
    </b>
    <br>
    <br>
    <p>
      (Interpreter & site by
      <a href="https://github.com/leozamboni">Leonardo Z. Nunes</a>.)
    </p>
    <br>

    <div id="textarea-container">
      <textarea id="stdin" onscroll="set_scroll()" oninput="highlight(this.value)"></textarea>
      <div id="hl"></div>
    </div>

    <br>

    <select onchange="examples()" id="examples">
      <option value="">Examples</option>
      <option value="helloWorld">Hello World</option>
      <option value="conditionals">Conditionals</option>
      <option value="procedures">Procedures</option>
      <option value="fibonacci">Fibonacci</option>
    </select>

    <br>
    <br>

    <button onclick="web_jsholyc_run()">RUN(â–¶)</button>

    <br>
    <br>

    <hr />
    <p>
      Not a complete HolyC language compiler yet. The source
      code is in GitHub you can contribute
      <a href="https://github.com/leozamboni/js-holyc-interpreter">here</a>. All currently implemented features are
      exemplified in the select
    </p>
    <p>This program is under MIT <a
        href="https://github.com/leozamboni/js-holyc-interpreter/blob/master/LICENSE">license</a></p>
    <br>
    <p>HolyC and TempleOS are creations of Terry Davis.</p>
  </main>
  <script>
    document.getElementById("stdin").value = '"hello world";';
    highlight('"hello world";')
    document.getElementById("stdin").addEventListener("keydown", function (e) {
      if (e.key == "Tab") {
        e.preventDefault();
        let start = this.selectionStart;
        let end = this.selectionEnd;

        // set textarea value to: text before caret + tab + text after caret
        this.value =
          this.value.substring(0, start) + "\t" + this.value.substring(end);

        // put caret at right position again
        this.selectionStart = this.selectionEnd = start + 1;

        highlight(document.getElementById("stdin").value)
      }
    });
    const examples = () => {
      let content = "";
      switch (document.getElementById("examples").value) {
        case "helloWorld":
          content =
            "// Online HolyC: Hello world\n" +
            '"Holy World\\n";\n\n' +
            "U0\n" +
            "HelloWorld()\n" +
            "{\n" +
            '\t"Holy World\\n";\n' +
            "}\n\n" +
            "U0\n" +
            "World()\n" +
            "{\n" +
            "\t'World\\n';\n" +
            "}\n\n" +
            "U0\n" +
            "Hello()\n" +
            "{\n" +
            "\t'Ho';\n\t'l', 'y';\n\t' ';\n" +
            "\tWorld();\n" +
            "}\n\n" +
            "'\\t';\n" +
            "Hello;\n" +
            "'\\n';\n" +
            'HelloWorld("*");';
          break;
        case "fibonacci":
          content =
            "// Online HolyC: Fibonacci\n" +
            "U0\n" +
            "Fibonacci()\n" +
            "{\n" +
            "\tU32 a = 0, b = 1, c, i;\n\n" +
            "\tfor (i = 0; i < 20; i++)\n" +
            "\t{\n" +
            "\t\tc = a + b;\n" +
            '\t\t"%d\\n", c;\n' +
            "\t\ta = b;\n" +
            "\t\tb = c;\n" +
            "\t}\n" +
            "}\n\n" +
            "Fibonacci;";
          break;
        case "conditionals":
          content =
            "// Online HolyC: Conditionals\n" +
            "if (TRUE)\n{\n" +
            "\tif (1 > 2)\n\t{\n" +
            "\t\t\"1 > 2\\n\";\n" +
            "\t}\n\telse if (1 > 2 || 2 > 3)\n\t{\n" +
            "\t\t\"2 > 3\\n\";\n" +
            "\t}\n\telse\n\t{\n" +
            "\t\t\"all false conditions\\n\";\n" +
            "\t}\n" +
            "}\n" +
            "\n" +
            "if (TRUE > FALSE)\n{\n" +
            "\t\"TRUE > FALSE\\n\";\n" +
            "}\n\n" +
            "// Conditionals with variables\n" +
            "U8 A = 1;\n" +
            "U8 B = 2;\n" +
            "if (A < B)\n{\n" +
            "\t\"A < B\\n\";\n" +
            "}\n\n" +
            "if (A)\n{\n" +
            "\t\"A != 0\\n\";\n" +
            "\tA = 0;\n" +
            "}\n\n" +
            "if (A)\n{\n" +
            "\t\"A == 0\\n\";\n" +
            "}\n\n" +
            "// Conditionals with math expressions\n" +
            "if (1 + 2 * 3 > 9)\n{\n" +
            "\t\"1 + 2 * 3 > 9\\n\";\n" +
            "}\nelse if (1 + 2 * 3 > A + 8)\n{\n" +
            "\t\"1 + 2 * 3 > A + 8\\n\";\n}\n\n";
          break;
        case "procedures":
          content =
            "// Online HolyC: Procedures\n" +
            "U0\nno_args_procedure()\n{\n" +
            "\t\"no args procedure\\n\";\n" +
            "}\n\n" + 
            "no_args_procedure;\n";
          break;
        default:
          content = "";
      }
      document.getElementById("stdin").value = content;
      highlight(content);
    };
  </script>
</body>

</html>